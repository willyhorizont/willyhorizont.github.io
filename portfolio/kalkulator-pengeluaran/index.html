<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LECMLYN21B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-LECMLYN21B');
    </script>
    <meta name="google-site-verification" content="UqB5vtnZNIl-hvyiqwM0PDgX772rcbWWjt0g9onB_BQ" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kalkulator Pengeluaran by Willy Horizont">
    <meta name="keywords" content="Kalkulator Pengeluaran by Willy Horizont">
    <meta name="author" content="Willy Horizont">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#000000">
    <link rel="icon" type="image/x-icon" href="../../favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../../android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../../android-chrome-512x512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
    <link rel="stylesheet" href="../../style.css">
    <title>Kalkulator Pengeluaran | Portfolio | Willy Horizont</title>
</head>
<body>
    <header>
        <nav id="navbar" class="navbar">
            <a href="/" class="app-logo"><img src="../../android-chrome-192x192.png" alt="Willy Horizont's logo" width="48px" height="48px">
                <!-- <span>Willy Horizont</span> -->
            </a>
            <div class="spacer"></div>
            <ul>
                <li class="navbar-item"><a href="/">Home</a></li>
                <li class="navbar-item-selected"><a href="/portfolio">Portfolio</a></li>
                <li class="navbar-item"><a href="/cv">CV</a></li>
                <li class="navbar-item"><a href="/links">Links</a></li>
                <li class="navbar-item"><a href="/about">About</a></li>
                <li class="navbar-item"><a href="/support">Support</a></li>
                <li class="navbar-item"><a href="/contact">Contact</a></li>
                <li class="navbar-item navbar-menu-close" onclick="toggleMenu()" style="padding: 16px;">✖</li>
            </ul>
            <span id="navbar-hamburger-menu" class="navbar-hamburger-menu" onclick="toggleMenu()">&#9776;</span>
        </nav>
    </header>
    <main>
        <div class="portfolio-expenses-calculator" style="padding: 8px;">
            <div class="portfolio-expenses-calculator-container">
                <h1 style="text-align: center;">Kalkulator Pengeluaran</h1>
                <!-- <p style="text-align: center; font-size: 1em;">Type whatever you spent that money on, separate 'em with a comma, and then hit "Enter" key - or just hit "Enter" key after each one.</p> -->
                <!-- <p style="text-align: center; font-size: 1em;">Ketik untuk apa saja uangnya dihabiskan, pisahkan dengan koma, lalu tekan "Enter" pada keyboard - atau langsung tekan tombol "Enter" setelah selesai mengetik satu.</p> -->
                <!-- 
                <div style="display: flex; flex-direction: column; padding: 4px 0px; row-gap: 8px;">
                    <p style="text-align: center; font-size: 1em;">pada kolom kiri, agar angka mudah dibaca bisa pisahkan angka dengan underscore atau titik. contoh 10_000 atau 14.000</p>
                    <p style="text-align: center; font-size: 1em;">pada kolom tengah, bisa pisahkan dengan koma, lalu tekan "Enter" pada keyboard - atau langsung tekan tombol "Enter" setelah selesai mengetik satu.</p>
                </div>
                 -->
                <div id="expenses-calculator-container" style="padding: 4px; width: 100%; display: flex; flex-direction: column; row-gap: 8px;">
                </div>
                <div style="padding: 4px; width: 100%; display: flex; flex-direction: column;">
                    <button onclick="createNewExpensesItem()" style="padding: 0.2em 0.4em; width: 1.9em; aspect-ratio: 1 / 1; background-color: #007bff; color: #ccc;">+</button>
                    <h2 style="margin-top: 8px;">Total Pengeluaran: <span id="total-expenses">0</span></h2>
                </div>
                <div style="padding: 4px; width: 100%; display: flex; flex-direction: column;">
                    <h2 style="margin-top: 8px;">Import & Export:</h2>
                    <textarea id="expenses-calculator-backup-restore-textarea" rows="4" cols="50" style="background-color: #000; color: #ccc; margin-top: 16px;" onblur="updateTextAreaContentToLocalStorageOnBlur(event)"></textarea>
                    <div id="error-message-container" style="margin-top: 8px;">
                    </div>
                </div>
            </div>
            <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top: 16px;">
                <div style="max-width: 50%; display: flex; flex-direction: row; justify-content: center; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <div style="border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; flex-wrap: wrap;">
                        <a href="https://trakteer.id/p3thvx/link?open=true" target="_blank" aria-label="Trakteer">
                            <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; padding: 8px; flex-wrap: wrap; column-gap: 8px;">
                                <p style="white-space: nowrap;">Support me via</p>
                                <div style="display: flex; flex-direction: row; align-items: center; justify-content: center;">
                                    <img src="https://trakteer.id/favicon/favicon-32x32.png" alt="Trakteer's logo" width="16px" height="16px">
                                    <p style="white-space: nowrap; margin-left: 4px;">Trakteer</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div style="border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; flex-wrap: wrap;">
                        <a href="https://saweria.co/p3thvx" target="_blank" aria-label="Saweria">
                            <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; padding: 8px; flex-wrap: wrap; column-gap: 8px;">
                                <p style="white-space: nowrap;">Support me via</p>
                                <div style="display: flex; flex-direction: row; align-items: center; justify-content: center;">
                                    <img src="https://encrypted-tbn2.gstatic.com/faviconV2?url=https://saweria.co&client=VFE&size=64&type=FAVICON&fallback_opts=TYPE,SIZE,URL&nfrp=2" alt="Saweria's logo" width="16px" height="16px">
                                    <p style="white-space: nowrap; margin-left: 4px;">Saweria</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div style="border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; flex-wrap: wrap;">
                        <a href="https://sociabuzz.com/p3thvx" target="_blank" aria-label="Sociabuzz">
                            <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; padding: 8px; flex-wrap: wrap; column-gap: 8px;">
                                <p style="white-space: nowrap;">Support me via</p>
                                <div style="display: flex; flex-direction: row; align-items: center; justify-content: center;">
                                    <img src="https://storage.sociabuzz.com/storage/img/tribe/logo.png" alt="Sociabuzz's logo" width="16px" height="16px">
                                    <p style="white-space: nowrap; margin-left: 4px;">Sociabuzz</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div style="border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; flex-wrap: wrap;">
                        <a href="https://www.nihbuatjajan.com/p3thvx" target="_blank" aria-label="Nih Buat Jajan">
                            <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; padding: 8px; flex-wrap: wrap; column-gap: 8px;">
                                <p style="white-space: nowrap;">Support me via</p>
                                <div style="display: flex; flex-direction: row; align-items: center; justify-content: center;">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRxp6o2dSrvX4XsYqykH8l5-APqtOuniis61Q&s" alt="Nih Buat Jajan's logo" width="16px" height="16px">
                                    <p style="white-space: nowrap; margin-left: 4px;">Nih Buat Jajan</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div style="border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; flex-wrap: wrap;">
                        <a href="https://nyawer.co/p3thvx" target="_blank" aria-label="Nyawer">
                            <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; padding: 8px; flex-wrap: wrap; column-gap: 8px;">
                                <p style="white-space: nowrap;">Support me via</p>
                                <div style="display: flex; flex-direction: row; align-items: center; justify-content: center;">
                                    <img src="https://nyawer.co/favicon_io/favicon.ico" alt="Nyawer's logo" width="16px" height="16px">
                                    <p style="white-space: nowrap; margin-left: 4px;">Nyawer</p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <p>Made with ❤️ by Willy Horizont</p>
    </footer>
    <script>
        const toggleMenu = () => {
            const navbarElement = document.getElementById("navbar");
            navbarElement.classList.toggle("responsive");
            const hamburgerMenuButtonElement = document.getElementById("navbar-hamburger-menu");
            hamburgerMenuButtonElement.classList.toggle("visible");
        };

        const isNan = (num) => Number.isNaN(parseFloat(num));

        const localStorageKey = "expenses";

        const chipInputString = '<input onkeydown="changeCurrentExpensesItemItemsOnKeyDown(event)" onfocusout="changeCurrentExpensesItemItemsOnBlur(event)" type="text" placeholder="untuk apa saja" style="margin: 8px 4px 8px 4px; background-color: #000; color: #ccc; padding: 8px 4px; border: none; outline: none;">';

        const chipRemoveButtonString = `<div style="display: flex; align-items: center; justify-content: center; background-color: #000; color: #ccc; width: 1.2em; aspect-ratio: 1 / 1; border-radius: 50%;">
    <span onclick="removeCurrentChip(this)" style="cursor: pointer; font-weight: bold;">×</span>
</div>`;

        const removeExpenseItemButtonString = `<div style="display: flex; flex-direction: column; justify-content: flex-start; align-items: center;">
    <button onclick="removeCurrentExpensesItemItem(this)" style="margin-left: 8px; background: red; color: white; border: none; padding: 0.2em 0.4em; cursor: pointer; width: 1.6em; aspect-ratio: 1 / 1;">x</button>
</div>`;

        const getPriceInputString = (value = "", priceValue = "", priceDisplay = "") => `<div style="display: flex; flex-direction: column; justify-content: flex-start; align-items: center;">
    <input value="${value}" data-price-value="${priceValue}" data-price-display="${priceDisplay}" onchange="changeCurrentExpensesItemPrice(this)" type="text" placeholder="jumlah uang" style="background-color: #000; color: #ccc; border: 1px solid #ccc; padding: 4px 8px; outline: none; max-width: 120px;">
</div>`;

        const getExpenseChipInputString = (children) => `<div style="margin-left: 8px; display: flex; flex-flow: wrap; background-color: #000; border: 1px solid #ccc; flex: 1; padding: 0px 4px; overflow-x: scroll;">
    ${children}
</div>`;

        const getExpenseChipString = (children, item) => `<div data-item="${item}" style="margin: 8px 4px; background: #999; color: #222; padding: 0.2em 0.4em; border-radius: 0.2em; display: flex; align-items: center; gap: 8px;">
${children}
</div>`;

        const getExpenseChipValueContainerString = (value) => `<span style="white-space: nowrap;">${value}</span>`;

        const getExpensesItemString = (children, priceValue = "", priceDisplay = "", items = "") => `<div data-price-value="${priceValue}" data-price-display="${priceDisplay}" data-items="${items}" style="width: 100%; padding: 8px; display: flex; flex-direction: row; border: 1px solid #fff; background-color: #091929;">
    ${children}
</div>`;

        const expensesCalculatorContainer = document.getElementById("expenses-calculator-container");
        const totalExpensesElement = document.getElementById("total-expenses");

        const updateTextAreaContentFromLocalStorage = (expensesData) => {
            const elementImportExportExpensesCalculatorTextarea = document.getElementById("expenses-calculator-backup-restore-textarea");
            elementImportExportExpensesCalculatorTextarea.value = ((expensesData === null) ? "" : JSON.stringify(expensesData));
        };

        const saveToLocalStorage = () => {
            let expensesData = Array.from(expensesCalculatorContainer.children).map((expensesItemElement) => ({
                priceDisplay: expensesItemElement.dataset.priceDisplay ?? "",
                priceValue: parseFloat(isNan(expensesItemElement.dataset.priceValue) ? 0 : expensesItemElement.dataset.priceValue),
                items: expensesItemElement.dataset.items ?? ""
            }));
            expensesData = ((expensesData.length === 0) ? null : expensesData);
            localStorage.setItem(localStorageKey, JSON.stringify(expensesData));
            updateTextAreaContentFromLocalStorage(expensesData);
            document.getElementById("error-message-container").innerHTML = "";
        };

        const removeDuplicateStringFromArrayOfString = (anyArray) => {
            const seen = {};
            const uniqueArray = [];

            anyArray.forEach((item) => {
                if (seen?.[item] === undefined) {
                    seen[item] = true;
                    uniqueArray.push(item);
                }
            });

            return uniqueArray;
        };

        const updateTotalExpenses = () => {
            const totalExpenses = Array.from(document.querySelectorAll("#expenses-calculator-container div")).reduce((currentResult, currentExpensesItemItem) => (currentResult + parseFloat(isNan(currentExpensesItemItem.dataset.priceValue) ? 0 : currentExpensesItemItem.dataset.priceValue)), 0);
            if (isNan(totalExpenses) === true) {
                totalExpensesElement.innerText = 0
                return;
            }
            totalExpensesElement.innerText = totalExpenses.toLocaleString("id-ID");
        };

        const changeCurrentExpensesItemPrice = (priceInputElement) => {
            const priceInputValue = priceInputElement.value.split("_").join("").split(".").join("");
            priceInputElement.parentElement.parentElement.dataset.priceValue = priceInputValue;
            priceInputElement.parentElement.parentElement.dataset.priceDisplay = priceInputElement.value;
            priceInputElement.parentElement.parentElement.insertAdjacentHTML("afterbegin", getPriceInputString(priceInputElement.value, priceInputValue, priceInputElement.value));
            priceInputElement.parentElement.remove();
            updateTotalExpenses();
            saveToLocalStorage();
        };

        const removeCurrentChip = (closeButtonEl) => {
            closeButtonEl.parentElement.parentElement.parentElement.parentElement.dataset.items = closeButtonEl.parentElement.parentElement.parentElement.parentElement.dataset.items.split(",").filter((item) => (item.trim() !== closeButtonEl.parentElement.parentElement.dataset.item)).join(",");
            closeButtonEl.parentElement.parentElement.remove();
            saveToLocalStorage();
        };

        const changeCurrentExpensesItemItems = (event) => {
            const inputElement = event.target;
            const expenseChipInputElement = inputElement.parentElement;
            const inputElementValue = inputElement.value.split(",").filter((item) => (item.trim() !== "")).join(",");
            const inputElementValueNew = ((inputElement.parentElement.parentElement.dataset.items === "") ? inputElementValue : (inputElement.parentElement.parentElement.dataset.items + ", " + inputElementValue));
            const inputElementValueNoDuplicate = removeDuplicateStringFromArrayOfString(inputElementValueNew.split(",").map((item) => (item.trim()))).join(", ");
            inputElement.parentElement.parentElement.dataset.items = inputElementValueNoDuplicate;

            const chips = inputElementValueNoDuplicate.split(",").map((value) => (getExpenseChipString(`${getExpenseChipValueContainerString(value.trim())}
${chipRemoveButtonString}`, value.trim()))).join("");

            inputElement.parentElement.innerHTML = `${chips}
${chipInputString}`;
            inputElement.value = "";
            saveToLocalStorage();
            const newInput = expenseChipInputElement.querySelector("input");
            return newInput;
        };

        const changeCurrentExpensesItemItemsOnKeyDown = (event) => {
            if (event.key === "Enter") {
                if (event.target.value.trim() === "") {
                    event.preventDefault();
                    return;
                }
                // changeCurrentExpensesItemItems(event);
                const newInput = changeCurrentExpensesItemItems(event);
                newInput.focus();
                event.preventDefault();
            }
        };

        const changeCurrentExpensesItemItemsOnBlur = (event) => {
            if (event.target.value.trim() === "") {
                event.preventDefault();
                return;
            }
            changeCurrentExpensesItemItems(event);
            event.preventDefault();
        };

        const removeCurrentExpensesItemItem = (removeButtonEl) => {
            removeButtonEl.parentElement.parentElement.remove();
            updateTotalExpenses();
            saveToLocalStorage();
        };

        const createNewExpensesItem = () => {
            expensesCalculatorContainer.innerHTML += getExpensesItemString(`${getPriceInputString()}
${getExpenseChipInputString(chipInputString)}
${removeExpenseItemButtonString}`);
        };

        const rerenderExpensesCalculator = (expensesData) => {
            expensesCalculatorContainer.innerHTML = expensesData.map(({ priceValue, priceDisplay, items }) => (getExpensesItemString(`${getPriceInputString(priceDisplay, priceValue, priceDisplay)}
    ${getExpenseChipInputString(`${items.split(", ").map((item) => (getExpenseChipString(`${getExpenseChipValueContainerString(item)}
${chipRemoveButtonString}`, item))).join("")}
    ${chipInputString}`)}
    ${removeExpenseItemButtonString}`, priceValue, priceDisplay, items))).join("");
            updateTotalExpenses();
        };

        const loadFromLocalStorage = () => {
            const expensesCalculatorSavedData = JSON.parse(localStorage.getItem(localStorageKey));
            if (expensesCalculatorSavedData === null) return;
            updateTextAreaContentFromLocalStorage(expensesCalculatorSavedData);
            rerenderExpensesCalculator(expensesCalculatorSavedData);
        };

        const updateTextAreaContentToLocalStorage = (event) => {
            const elementImportExportExpensesCalculatorTextarea = event.target;
            const expensesCalculatorBackupRestoreTextareaElementValue = elementImportExportExpensesCalculatorTextarea.value;
            try {
                const expensesData = JSON.parse(expensesCalculatorBackupRestoreTextareaElementValue);
                // console.log(expensesCalculatorBackupRestoreTextareaElementValue);
                // console.log(JSON.stringify(expensesData));
                localStorage.setItem(localStorageKey, JSON.stringify(expensesData));
                rerenderExpensesCalculator(expensesData);
            } catch (anyError) {
                document.getElementById("error-message-container").innerHTML = `
                    <p style="color: red;">Format backup-an yang di-restore tidak sesuai.</p>
                `;
            }
        };

        const updateTextAreaContentToLocalStorageOnBlur = (event) => {
            if (event.target.value.trim() === "") {
                event.preventDefault();
                return;
            }
            updateTextAreaContentToLocalStorage(event);
            // loadFromLocalStorage();
            event.preventDefault();
        };

        loadFromLocalStorage();
    </script>
</body>
</html>

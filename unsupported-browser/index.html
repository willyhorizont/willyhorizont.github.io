<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="../style.css" />
        <title>Unsupported Browser | Willy Horizont</title>

        <script src="../utils.js"></script>
        <script src="../utils-web.js"></script>
    </head>
    <body>
        <main>
            <div id="main-content" data-display="flex" style="display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; row-gap: 8px; background-color: var(--safe-background-color-1); color: var(--safe-text-color-1);">
                <h1 style="text-align: center;">Unsupported Browser</h1>
                <h2>⛔ Access Denied ⛔</h2>
                <p style="text-align: center;">Your <strong id="user-web-browser-placeholder">web browser</strong> is not supported.</p>
                <p style="text-align: center;">Please use <strong id="google-chrome-stable-version-placeholder">latest Google Chrome</strong> to have access.</p>
                <a href="https://www.google.com/chrome/" target="_blank" rel="noopener noreferrer" style="color:blue;">Download Chrome</a>
            </div>
            <div id="loading-spinner"></div>
        </main>
        <script src="../../component/component-loading-spinner.js"></script>
        <script>
            (async () => {
                try {
                    ComponentLoadingSpinner.toggleLoadingSpinner(true, [document.getElementById("main-content")]);
                    const CHROMIUM_BASED_BROWSER_MINIMUM_STABLE_VERSION_PER_2025 = 134;
                    let chromiumBasedBrowserMinimumStableVersion = CHROMIUM_BASED_BROWSER_MINIMUM_STABLE_VERSION_PER_2025;
                    let userChromiumBasedBrowserVersionCurrent = 0;
                    let userWebBrowserCurrent = null;

                    const isUserUsingChromiumBasedBrowser = UtilsWeb.checkUserUsingChromiumBasedBrowser();
                    console.log(isUserUsingChromiumBasedBrowser);
                    if (isUserUsingChromiumBasedBrowser === false) {
                        document.getElementById("google-chrome-stable-version-placeholder").textContent = (`Google Chrome version >= ${chromiumBasedBrowserMinimumStableVersion}.x.xxxx.xx`);
                        console.log("masuk 1");
                        return;
                    }

                    try {
                        const [userWebBrowser, userChromiumBasedBrowserVersion] = await UtilsWeb.getUserChromiumBasedBrowserVersion();
                        userChromiumBasedBrowserVersionCurrent = userChromiumBasedBrowserVersion;
                        userWebBrowserCurrent = userWebBrowser;
                        console.log({ userWebBrowser, userChromiumBasedBrowserVersion });

                        chromiumBasedBrowserMinimumStableVersion = await UtilsWeb.getChromiumBasedBrowserMinimumStableVersion();
                        console.log({ chromiumBasedBrowserMinimumStableVersion });
                    } catch (anyError) {
                        // fallback to default value
                        console.log("masuk 2");
                        console.log({ masuk2: anyError });
                    }

                    const isUserUsingChromiumBasedBrowserMinimumStableVersion = (userChromiumBasedBrowserVersionCurrent >= chromiumBasedBrowserMinimumStableVersion);
                    console.log({ isUserUsingChromeMinStblVer: isUserUsingChromiumBasedBrowserMinimumStableVersion });

                    if (isUserUsingChromiumBasedBrowserMinimumStableVersion) {
                        window.location.href = "/";
                        console.log("masuk 3");
                        return;
                    }

                    document.getElementById("user-web-browser-placeholder").textContent = ((userWebBrowserCurrent === null) ? (`Google Chrome ${userChromiumBasedBrowserVersionCurrent}.x.xxxx.xx`) : (`${Utils.jsonStringify(userWebBrowserCurrent)} Google Chrome: ${userChromiumBasedBrowserVersionCurrent}`));
                    document.getElementById("google-chrome-stable-version-placeholder").textContent = (`Google Chrome version >= ${chromiumBasedBrowserMinimumStableVersion}.x.xxxx.xx`);
                    console.log("masuk 4");
                } catch (anyError) {
                    // do nothing :p
                    console.log("masuk 5");
                    console.log({ masuk5: anyError });
                } finally {
                    ComponentLoadingSpinner.toggleLoadingSpinner(false, [document.getElementById("main-content")]);
                }
            })();
        </script>
    </body>
</html>
